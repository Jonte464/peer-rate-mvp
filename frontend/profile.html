<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Min profil – PeerRate</title>

  <!-- PeerRate tema (orange / lila) -->
  <link rel="stylesheet" href="/css/pr-theme.css" />

  <!-- Din befintliga profil-styling (behålls) -->
  <link rel="stylesheet" href="/css/profile.css" />

  <style>
    /* Topbar (samma som index) */
    .pr-shell { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

    .pr-topbar{
      padding: 18px 0;
      position: sticky;
      top: 0;
      z-index: 50;
      background: color-mix(in srgb, var(--pr-bg) 92%, transparent);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .pr-topbar-inner{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .pr-brand{
      display:flex; align-items:center; gap:12px;
      text-decoration:none;
    }
    .pr-title{
      font-weight:700; font-size:22px; color:var(--pr-purple);
      line-height:1;
    }
    .pr-tagline{
      font-size:12px; color:var(--pr-muted); margin-top:2px;
    }
    .pr-nav{
      display:flex; align-items:center; gap:16px; flex-wrap:wrap;
    }
    .pr-nav a{
      color: var(--pr-purple);
      text-decoration:none;
      font-weight:600;
      opacity:.92;
    }
    .pr-nav a:hover{ opacity:1; text-decoration: underline; }
    .pr-nav .pr-cta{
      margin-left: 6px;
      padding: 10px 14px;
      border-radius: 12px;
      background: var(--pr-purple);
      color: #fff;
      text-decoration:none;
      font-weight:700;
      box-shadow: var(--pr-shadow);
    }
    .pr-nav .pr-cta:hover{ filter: brightness(.96); text-decoration:none; }

    .pr-logo-wrap{
      width:42px; height:42px;
      display:flex; align-items:center; justify-content:center;
      border-radius:14px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
      overflow:hidden;
    }
    .pr-logo-svg{ width:34px; height:34px; display:block; }

    /* Sido-padding / layout (så profile.css kan fortsätta styra korten) */
    .page{
      padding: 34px 0 50px;
    }
    .page h1{
      margin: 0 0 8px;
      font-size: 42px;
      color: var(--pr-purple);
      letter-spacing: -0.02em;
    }
    .page .lead{
      margin: 0 0 18px;
      color: var(--pr-muted);
      max-width: 80ch;
      font-size: 14px;
    }

    /* Se till att wrap i profile.css inte får “vit sida” */
    body{ background: var(--pr-bg); }

    /* Om profile.css har sin egen wrap maxbredd så behåller vi den,
       men vi centrerar och ger lite extra topp-luft */
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 0 16px 40px;
    }

    @media (max-width:600px){
      .page{ padding: 20px 0 40px; }
      .page h1{ font-size: 30px; }
    }
  </style>
</head>

<body>

  <!-- TOPBAR -->
  <div class="pr-topbar">
    <div class="pr-shell pr-topbar-inner">
      <a class="pr-brand" href="/#top">
        <div class="pr-logo-wrap" aria-hidden="true">
          <!-- Inline logo -->
          <svg class="pr-logo-svg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="PeerRate">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#2EC5B6"/>
                <stop offset="1" stop-color="#1EAFA3"/>
              </linearGradient>
            </defs>
            <path d="M32 6c10 0 22 4 22 16 0 22-16 34-22 36C26 56 10 44 10 22 10 10 22 6 32 6z" fill="url(#g)"/>
            <path d="M26 18h11c6 0 10 4 10 10s-4 10-10 10h-4v8h-7V18zm11 7h-4v6h4c2 0 3-1 3-3s-1-3-3-3z" fill="#ffffff"/>
          </svg>
        </div>
        <div>
          <div class="pr-title">PeerRate</div>
          <div class="pr-tagline">Betyg med vibe. För dig, av dig.</div>
        </div>
      </a>

      <nav class="pr-nav" aria-label="Huvudmeny">
        <a href="/#top">Hem</a>
        <a href="/customer.html">Registrera dig</a>
        <a href="/#rate">Lämna betyg</a>
        <a href="/profile.html">Min profil</a>
        <a href="/#how">Hur det fungerar?</a>
        <a href="/#contact">Övrigt</a>
        <a class="pr-cta" href="/profile.html">Starta</a>
      </nav>
    </div>
  </div>

  <main class="page">
    <div class="wrap">

      <!-- Inloggningsbadge -->
      <div id="user-badge" class="user-badge hidden">
        <div class="user-avatar" id="user-badge-avatar">PR</div>
        <div>
          <div class="user-label">Inloggad som</div>
          <div class="user-name" id="user-badge-name">–</div>
        </div>
      </div>

      <h1>Min profil</h1>
      <p class="lead">
        Här kan du se dina uppgifter och ditt samlade omdöme.
      </p>

      <!-- LOGIN-KORT (visas bara om man inte är inloggad) -->
      <section class="card" id="login-card">
        <h2>Logga in</h2>
        <p class="muted">
          Logga in med den e-post och det lösenord du registrerade dig med.
        </p>

        <form id="login-form" autocomplete="off">
          <label for="login-email">E-post</label>
          <input id="login-email" name="email" type="email" placeholder="erik@example.com" />

          <label for="login-password">Lösenord</label>
          <input id="login-password" name="password" type="password" placeholder="Ditt lösenord" />

          <div class="row" style="margin-top:12px">
            <button class="primary" type="submit" id="login-btn">Logga in</button>
          </div>

          <p id="login-status" class="tiny muted" style="margin-top:8px;"></p>
        </form>
      </section>

      <!-- Allt här visas bara när man är inloggad -->
      <div id="profile-root" class="hidden">

        <!-- Mina uppgifter -->
        <section class="card">
          <h2>Mina uppgifter</h2>
          <p class="tiny muted">Uppgifter kopplade till din profil.</p>

          <!-- Profilbild -->
          <div class="profile-avatar-block">
            <div class="profile-avatar-preview" id="profile-avatar-preview">PR</div>
            <div>
              <label class="profile-avatar-upload-label">
                Ladda upp profilbild
                <input type="file" id="profile-avatar-input" accept="image/*" />
              </label>
              <p class="profile-avatar-text">
                Bilden sparas bara lokalt i din webbläsare och kopplas till “Inloggad som”.
              </p>
            </div>
          </div>

          <ul class="profile-list">
            <li>
              <span class="profile-label">Namn</span>
              <span class="profile-value" id="profile-name">–</span>
            </li>
            <li>
              <span class="profile-label">E-post</span>
              <span class="profile-value" id="profile-email">–</span>
            </li>
            <li>
              <span class="profile-label">Personnummer</span>
              <span class="profile-value" id="profile-personalNumber">–</span>
            </li>
            <li>
              <span class="profile-label">Telefon</span>
              <span class="profile-value" id="profile-phone">–</span>
            </li>
            <li>
              <span class="profile-label">Gatuadress</span>
              <span class="profile-value" id="profile-addressStreet">–</span>
            </li>
            <li>
              <span class="profile-label">Postnummer</span>
              <span class="profile-value" id="profile-addressZip">–</span>
            </li>
            <li>
              <span class="profile-label">Ort</span>
              <span class="profile-value" id="profile-addressCity">–</span>
            </li>
            <li>
              <span class="profile-label">Land</span>
              <span class="profile-value" id="profile-country">–</span>
            </li>
          </ul>
        </section>

        <!-- Externa data -->
        <section class="card" id="external-data-section">
          <h2>Externa data</h2>
          <p class="tiny muted">
            Här visas viss information som hämtats från externa, offentliga källor kopplat till din profil.
            Uppgifterna uppdateras automatiskt med jämna mellanrum.
          </p>

          <ul class="profile-list">
            <li>
              <span class="profile-label">Fordon (antal)</span>
              <span class="profile-value" id="ext-vehicles-count"></span>
            </li>
            <li>
              <span class="profile-label">Fastigheter (antal)</span>
              <span class="profile-value" id="ext-properties-count"></span>
            </li>
            <li>
              <span class="profile-label">Senast uppdaterad</span>
              <span class="profile-value" id="ext-last-updated"></span>
            </li>
            <li>
              <span class="profile-label">Validerad adress</span>
              <span class="profile-value"><span data-field="externalAddressLine">–</span></span>
            </li>
            <li>
              <span class="profile-label">Adressstatus</span>
              <span class="profile-value"><span data-field="externalAddressStatus">–</span></span>
            </li>
          </ul>
        </section>

        <!-- ✅ eBay-koppling -->
        <section class="card" id="ebay-card">
          <h2>eBay-koppling</h2>
          <p class="tiny muted">
            Koppla ditt eBay-konto för att hämta ordrar (säljarsidan/fulfillment).
          </p>

          <div class="row" style="margin-top:8px;">
            <button type="button" class="primary" id="ebay-connect-btn">
              Koppla eBay-konto
            </button>
            <button type="button" class="secondary" id="ebay-orders-btn">
              Hämta eBay-ordrar
            </button>
          </div>

          <p id="ebay-status" class="tiny muted" style="margin-top:8px;"></p>

          <div id="ebay-orders-section" style="margin-top:12px;">
            <h3>Ordrar från eBay</h3>
            <div id="ebay-orders-list" class="ratings-list"></div>
          </div>
        </section>

        <!-- Tradera-koppling -->
        <section class="card" id="tradera-card">
          <h2>Tradera-koppling</h2>
          <p class="tiny muted">
            Koppla ditt Tradera-konto för att visa avslutade affärer som en del av ditt förtroendeunderlag.
            Dina Tradera-uppgifter används endast för att hämta information kopplad till dina affärer.
          </p>

          <div class="row">
            <div>
              <label for="tradera-username-input">Tradera-användarnamn</label>
              <input id="tradera-username-input" type="text" placeholder="Ditt Tradera-användarnamn" />
            </div>
            <div>
              <label for="tradera-password-input">Tradera-lösenord (valfritt)</label>
              <input id="tradera-password-input" type="password" placeholder="Ditt Tradera-lösenord" />
              <p class="tiny muted">
                Lösenordet lagras krypterat. Lämna tomt om du bara vill spara användarnamnet.
              </p>
            </div>
          </div>

          <div class="row" style="margin-top:8px;">
            <button type="button" class="primary" id="tradera-connect-btn">
              Koppla / uppdatera Tradera-konto
            </button>
            <button type="button" class="secondary" id="tradera-mock-btn">
              Skapa demoaffärer från Tradera
            </button>
            <button type="button" class="secondary" id="tradera-sync-btn">
              Synka riktiga Tradera-affärer
            </button>
          </div>

          <p id="tradera-notice" class="tiny muted" style="margin-top:8px;"></p>

          <hr style="margin:16px 0;border:none;border-top:1px solid rgba(0,0,0,.06);" />

          <h3>Översikt</h3>
          <ul class="profile-list">
            <li>
              <span class="profile-label">Användarnamn</span>
              <span class="profile-value" id="tradera-username-label">–</span>
            </li>
            <li>
              <span class="profile-label">Senast synkad</span>
              <span class="profile-value" id="tradera-last-synced">–</span>
            </li>
          </ul>

          <div id="tradera-orders-section" style="margin-top:12px;">
            <h3>Avslutade affärer från Tradera</h3>
            <p id="tradera-orders-summary" class="tiny muted"></p>
            <div id="tradera-orders-list" class="ratings-list"></div>
          </div>

        </section>

        <!-- Mitt omdöme -->
        <section class="card">
          <h2>Mitt omdöme</h2>
          <p class="tiny muted">
            Sammanfattning av betyg som är kopplade till din e-postadress.
          </p>

          <div class="ratings-visuals">
            <div class="ratings-visual-box">
              <h3 class="tiny">Varifrån kommer dina omdömen?</h3>
              <div id="rating-source-pie" class="rating-pie">
                <div id="rating-source-pie-label" class="rating-pie-center-label">Inga omdömen</div>
              </div>
              <div id="rating-source-legend" class="rating-legend tiny muted"></div>
            </div>

            <div class="ratings-visual-box">
              <h3 class="tiny">Din PeerRate-rating</h3>
              <div id="rating-p-symbols" class="rating-p-row"></div>
              <div id="rating-p-symbols-text" class="tiny muted"></div>
            </div>
          </div>

          <p class="score-line">
            Snittbetyg:
            <strong><span id="profile-score">–</span> / 5</strong>
            <span class="tiny muted">
              (baserat på <span id="profile-score-count">0</span> omdömen)
            </span>
          </p>
          <div class="score-bar">
            <div class="score-bar-fill" id="profile-score-bar"></div>
          </div>

          <div id="ratings-graph" class="ratings-graph"></div>
          <div id="ratings-list" class="ratings-list"></div>
        </section>

        <!-- Logga ut -->
        <section class="card">
          <button id="logout-btn" type="button" class="secondary">Logga ut</button>
        </section>

      </div>

      <div style="text-align:center;color:var(--pr-muted);font-size:12px;margin-top:18px;">
        © 2025 by PeerRate.
      </div>
    </div>
  </main>

  <script type="module" src="/modules/main.js"></script>
</body>
</html>
