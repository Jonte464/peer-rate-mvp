<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Min profil – PeerRate</title>

  <link rel="stylesheet" href="/css/pr-theme.css" />
  <link rel="stylesheet" href="/css/profile.css" />
</head>

<body>

  <!-- ✅ Global TOP ROW injectas via pageBootstrap.js -->
  <div id="slot-top-row"></div>

  <main class="page">
    <div class="wrap">

      <!-- Inloggningsbadge -->
      <div id="user-badge" class="user-badge hidden">
        <div class="user-avatar" id="user-badge-avatar" title="Klicka för att byta bild">PR</div>
        <div>
          <div class="user-label" data-i18n="profile_badge_label">Inloggad som</div>
          <div class="user-name" id="user-badge-name">–</div>
        </div>
      </div>

      <h1 data-i18n="profile_h1">Min profil</h1>
      <p class="lead" data-i18n="profile_lead">
        Här kan du se dina uppgifter och ditt samlade omdöme.
      </p>

      <!-- LOGIN-KORT (visas bara om man inte är inloggad) -->
      <section class="card" id="login-card">
        <h2 data-i18n="profile_login_title">Logga in</h2>
        <p class="muted" data-i18n="profile_login_lead">
          Logga in med den e-post och det lösenord du registrerade dig med.
        </p>

        <form id="login-form" autocomplete="off">
          <label for="login-email" data-i18n="profile_login_email">E-post</label>
          <input id="login-email" name="email" type="email" placeholder="erik@example.com" />

          <label for="login-password" data-i18n="profile_login_password">Lösenord</label>
          <input id="login-password" name="password" type="password" placeholder="Ditt lösenord" />

          <div class="row" style="margin-top:12px">
            <button class="primary" type="submit" id="login-btn" data-i18n="profile_login_btn">Logga in</button>
          </div>

          <p id="login-status" class="tiny muted" style="margin-top:8px;"></p>
        </form>
      </section>

      <!-- Allt här visas bara när man är inloggad -->
      <div id="profile-root" class="hidden">

        <!-- ✅ Mitt omdöme -->
        <section class="card">
          <h2 data-i18n="profile_my_rating_title">Mitt omdöme</h2>
          <p class="tiny muted" data-i18n="profile_my_rating_lead">
            Sammanfattning av betyg som är kopplade till din e-postadress.
          </p>

          <div class="ratings-visuals">
            <div class="ratings-visual-box">
              <h3 class="tiny" data-i18n="profile_rating_sources_title">Varifrån kommer dina omdömen?</h3>
              <div id="rating-source-pie" class="rating-pie">
                <div id="rating-source-pie-label" class="rating-pie-center-label" data-i18n="profile_no_ratings">Inga omdömen</div>
              </div>
              <div id="rating-source-legend" class="rating-legend tiny muted"></div>
            </div>

            <div class="ratings-visual-box">
              <h3 class="tiny" data-i18n="profile_pr_rating_title">Din PeerRate-rating</h3>
              <div id="rating-p-symbols" class="rating-p-row"></div>
              <div id="rating-p-symbols-text" class="tiny muted"></div>
            </div>
          </div>

          <p class="score-line">
            <span data-i18n="profile_avg_label">Snittbetyg:</span>
            <strong><span id="profile-score">–</span> / 5</strong>
            <span class="tiny muted">(<span data-i18n="profile_based_on">baserat på</span> <span id="profile-score-count">0</span> <span data-i18n="profile_reviews">omdömen</span>)</span>
          </p>

          <div class="score-bar">
            <div class="score-bar-fill" id="profile-score-bar"></div>
          </div>

          <div id="ratings-graph" class="ratings-graph"></div>
          <div id="ratings-list" class="ratings-list"></div>
        </section>

        <!-- ✅ Arbetsreferenser (ny modul i rätt stil) -->
        <section class="card" id="work-references-card">
          <h2 data-i18n="profile_workrefs_title">Arbetsreferenser</h2>
          <p class="tiny muted" data-i18n="profile_workrefs_lead">
            Samla och dela verifierbara referenser från uppdrag och arbetsgivare.
          </p>

          <div class="row" style="margin-top:12px">
            <a class="primary" href="/references.html"
               style="display:inline-block;text-decoration:none;padding:10px 14px;border-radius:10px;"
               data-i18n="profile_workrefs_btn">Öppna arbetsreferenser</a>
          </div>
        </section>

        <!-- Mina uppgifter -->
        <section class="card">
          <h2 data-i18n="profile_my_details_title">Mina uppgifter</h2>
          <p class="tiny muted" data-i18n="profile_my_details_lead">Uppgifter kopplade till din profil.</p>

          <!-- Profilbild -->
          <div class="profile-avatar-block">
            <div class="profile-avatar-preview" id="profile-avatar-preview">PR</div>
            <div>
              <label class="profile-avatar-upload-label" data-i18n="profile_avatar_upload">
                Ladda upp profilbild
                <input type="file" id="profile-avatar-input" accept="image/*" />
              </label>
              <p class="profile-avatar-text" data-i18n="profile_avatar_note">
                Bilden sparas bara lokalt i din webbläsare och kopplas till “Inloggad som”.
              </p>
            </div>
          </div>

          <ul class="profile-list">
            <li><span class="profile-label">Namn</span><span class="profile-value" id="profile-name">–</span></li>
            <li><span class="profile-label">E-post</span><span class="profile-value" id="profile-email">–</span></li>
            <li><span class="profile-label">Personnummer</span><span class="profile-value" id="profile-personalNumber">–</span></li>
            <li><span class="profile-label">Telefon</span><span class="profile-value" id="profile-phone">–</span></li>
            <li><span class="profile-label">Gatuadress</span><span class="profile-value" id="profile-addressStreet">–</span></li>
            <li><span class="profile-label">Postnummer</span><span class="profile-value" id="profile-addressZip">–</span></li>
            <li><span class="profile-label">Ort</span><span class="profile-value" id="profile-addressCity">–</span></li>
            <li><span class="profile-label">Land</span><span class="profile-value" id="profile-country">–</span></li>
          </ul>
        </section>

        <!-- Externa data -->
        <section class="card" id="external-data-section">
          <h2>Externa data</h2>
          <p class="tiny muted">
            Här visas viss information som hämtats från externa, offentliga källor kopplat till din profil.
            Uppgifterna uppdateras automatiskt med jämna mellanrum.
          </p>

          <ul class="profile-list">
            <li><span class="profile-label">Fordon (antal)</span><span class="profile-value" id="ext-vehicles-count"></span></li>
            <li><span class="profile-label">Fastigheter (antal)</span><span class="profile-value" id="ext-properties-count"></span></li>
            <li><span class="profile-label">Senast uppdaterad</span><span class="profile-value" id="ext-last-updated"></span></li>
            <li><span class="profile-label">Validerad adress</span><span class="profile-value"><span data-field="externalAddressLine">–</span></span></li>
            <li><span class="profile-label">Adressstatus</span><span class="profile-value"><span data-field="externalAddressStatus">–</span></span></li>
          </ul>
        </section>

        <!-- eBay-koppling (tillfälligt dold) -->
        <section class="card hidden" id="ebay-card" style="display:none;"></section>

        <!-- Tradera-koppling (tillfälligt dold) -->
        <section class="card hidden" id="tradera-card" style="display:none;"></section>

        <!-- Logga ut -->
        <section class="card">
          <button id="logout-btn" type="button" class="secondary" data-i18n="profile_logout_btn">Logga ut</button>
        </section>

      </div>

      <div style="text-align:center;color:rgba(15,15,18,.55);font-size:12px;margin-top:18px;">
        © 2025 by PeerRate.
      </div>
    </div>
  </main>

  <!-- ✅ Single entrypoint: inject header → init language → load main.js -->
  <script type="module" src="/modules/pageBootstrap.js"></script>
</body>
</html>
