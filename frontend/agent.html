<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>PeerRate Agent – Inställningar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="./style.css" />

  <style>
    :root {
      --brand-orange:#f6a94b;
      --brand-card:#fbf2e6;
      --brand-border:#eadfce;
      --brand-ink:#1e1830;
      --brand-ink-d:#4a425e;
      --brand-purple:#1b1533;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color: var(--brand-ink);
      background: var(--brand-orange);
    }

    .agent-page-wrap {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 16px;
    }

    .agent-card-shell {
      width: 100%;
      max-width: 960px;
      background: var(--brand-card);
      border-radius: 24px;
      border: 1px solid var(--brand-border);
      box-shadow: 0 18px 45px rgba(0,0,0,.12);
      padding: 20px 22px 24px;
    }

    .agent-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }

    .agent-title {
      font-size: 22px;
      font-weight: 800;
      margin: 0;
    }

    .agent-sub {
      font-size: 13px;
      color: var(--brand-ink-d);
      margin: 4px 0 0;
    }

    .agent-layout {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-top: 14px;
      margin-bottom: 16px;
    }

    .agent-panel {
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.05);
      padding: 14px 14px 16px;
    }

    .agent-panel h2 {
      margin: 0 0 6px;
      font-size: 16px;
    }

    .agent-panel-desc {
      font-size: 12px;
      color: var(--brand-ink-d);
      margin: 0 0 10px;
    }

    .agent-section {
      margin-bottom: 10px;
    }

    .agent-section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .06em;
      color: var(--brand-ink-d);
      margin-bottom: 4px;
    }

    .agent-option {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      font-size: 13px;
      color: var(--brand-ink);
    }

    .agent-option input[type="checkbox"] {
      width: 18px;
      height: 18px;
      transform: scale(1.15);
      margin: 0;
    }

    .agent-option label {
      cursor: pointer;
      line-height: 1.4;
    }

    .agent-textarea {
      width: 100%;
      min-height: 70px;
      border-radius: 12px;
      border: 1px solid #d9cbb7;
      background: #fff;
      color: var(--brand-ink);
      padding: 8px 10px;
      font-size: 12px;
      resize: vertical;
      font-family: inherit;
    }

    .agent-select-group {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
      color: var(--brand-ink);
    }

    .agent-select-label {
      font-weight: 600;
    }

    .agent-select {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #d9cbb7;
      background: #fff;
      color: var(--brand-ink);
      padding: 6px 10px;
      font-size: 12px;
      font-family: inherit;
    }

    .agent-summary-card {
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.05);
      padding: 12px 14px 16px;
      margin-top: 4px;
    }

    .agent-summary-title {
      font-size: 14px;
      font-weight: 700;
      margin: 0 0 4px;
    }

    .agent-summary-text {
      font-size: 12px;
      color: var(--brand-ink);
      line-height: 1.4;
    }

    .agent-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .agent-pill {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #d1c4b8;
      font-size: 11px;
      background: #fff7f0;
      color: var(--brand-ink-d);
    }

    .agent-prompt-box {
      margin-top: 14px;
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.05);
      padding: 12px 14px 16px;
    }

    .agent-prompt-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .agent-prompt-header h3 {
      margin: 0;
      font-size: 14px;
    }

    .agent-prompt-note {
      font-size: 11px;
      color: var(--brand-ink-d);
      margin: 0 0 6px;
    }

    .agent-prompt-textarea {
      width: 100%;
      min-height: 90px;
      border-radius: 12px;
      border: 1px solid #d9cbb7;
      background: #fffaf4;
      color: var(--brand-ink);
      padding: 8px 10px;
      font-size: 12px;
      resize: vertical;
      font-family: inherit;
    }

    .agent-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: 999px;
      border: 0;
      background: var(--brand-purple);
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
    }

    .agent-btn:hover {
      filter: brightness(1.05);
    }

    .agent-footer {
      margin-top: 8px;
      font-size: 11px;
      color: var(--brand-ink-d);
    }

    .agent-footer code {
      font-size: 11px;
      background: rgba(0,0,0,.03);
      padding: 1px 3px;
      border-radius: 4px;
    }

    @media (max-width: 900px) {
      .agent-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="agent-page-wrap">
    <div class="agent-card-shell">
      <header class="agent-header-bar">
        <div>
          <h1 class="agent-title">PeerRate Agent – inställningar</h1>
          <p class="agent-sub">
            Ställ in vilka regler och automatiska beteenden din utvecklar-/AI-agent ska följa.
          </p>
        </div>
      </header>

      <main class="agent-layout">
        <!-- BLOCK 1: Regler / Promptprofil -->
        <section class="agent-panel" id="rules-card">
          <h2>Block 1 – Regler & stil</h2>
          <p class="agent-panel-desc">
            Här väljer du hur agenten ska skriva, tänka och förhålla sig till kod.
          </p>

          <!-- Språk & pedagogik -->
          <div class="agent-section">
            <div class="agent-section-title">Språk & pedagogik</div>

            <div class="agent-select-group">
              <span class="agent-select-label">Kunskapsnivå</span>
              <select id="level-select" class="agent-select">
                <option value="beginner" selected>Nybörjare</option>
                <option value="intermediate">Medel</option>
                <option value="expert">Expert</option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Hur ska svaren vara grundade?</span>
              <select id="answer-style-select" class="agent-select">
                <option value="reflective" selected>
                  Reflekterande / hypotetiska (mycket resonemang)
                </option>
                <option value="strict">
                  Strikta, icke-hallucinerande (så korrekt som möjligt)
                </option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Max antal steg per svar</span>
              <select id="steps-select" class="agent-select">
                <option value="1">1 steg</option>
                <option value="2">2 steg</option>
                <option value="3" selected>3 steg</option>
                <option value="4">4 steg</option>
                <option value="5">5 steg</option>
                <option value="6">6 steg</option>
                <option value="7">7 steg</option>
                <option value="8">8 steg</option>
                <option value="9">9 steg</option>
                <option value="10">10 steg</option>
              </select>
            </div>
          </div>

          <!-- Svarslayout -->
          <div class="agent-section">
            <div class="agent-section-title">Svarslayout</div>

            <div class="agent-select-group">
              <span class="agent-select-label">Svarslängd</span>
              <select id="answer-length-select" class="agent-select">
                <option value="short">Kort (komprimerat)</option>
                <option value="medium" selected>Medel (balans)</option>
                <option value="long">Långt (mycket detaljer)</option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Format</span>
              <select id="answer-format-select" class="agent-select">
                <option value="steps" selected>Steg-för-steg lista</option>
                <option value="summary-details">Sammanfattning överst, detaljer under</option>
                <option value="code-first">Kod först, sedan förklaring</option>
                <option value="explanation-first">Förklaring först, sedan kod</option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Exempelnivå</span>
              <select id="example-level-select" class="agent-select">
                <option value="none">Inga exempel</option>
                <option value="some" selected>Några exempel vid behov</option>
                <option value="many">Många exempel / use-cases</option>
              </select>
            </div>
          </div>

          <!-- Kod & säkerhet -->
          <div class="agent-section">
            <div class="agent-section-title">Kod & säkerhet</div>
            <div class="agent-option">
              <input type="checkbox" id="rule-no-hallucinations" checked />
              <label for="rule-no-hallucinations">
                Minimera <strong>hallucinationer</strong>: om information saknas, fråga istället för att hitta på.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="rule-full-blocks" checked />
              <label for="rule-full-blocks">
                Ge alltid <strong>hela kodblock eller hela filer</strong> som kan klistras in direkt i VS Code.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="rule-ask-for-current-code" checked />
              <label for="rule-ask-for-current-code">
                Be alltid först om <strong>nuvarande kod</strong> innan du föreslår ny kod.
              </label>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Hur ska oklarheter hanteras?</span>
              <select id="uncertainty-select" class="agent-select">
                <option value="ask" selected>Ställ följdfrågor hellre än att anta</option>
                <option value="assume-annotated">Gör rimliga antaganden men markera dem tydligt</option>
                <option value="minimal-assumptions">Gör så få antaganden som möjligt, lämna hellre öppet</option>
              </select>
            </div>
          </div>

          <!-- Mentorskap & initiativ -->
          <div class="agent-section">
            <div class="agent-section-title">Mentorskap & initiativ</div>

            <div class="agent-select-group">
              <span class="agent-select-label">Mentor-nivå</span>
              <select id="mentor-level-select" class="agent-select">
                <option value="soft" selected>Mjuk coach (stödjande)</option>
                <option value="balanced">Balans (ärlig men vänlig)</option>
                <option value="direct">Direkt (rakt på sak)</option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Initiativnivå</span>
              <select id="initiative-select" class="agent-select">
                <option value="follow" selected>Följ order – föreslå sällan annat</option>
                <option value="balanced">Balans – föreslå förbättringar när det är vettigt</option>
                <option value="proactive">Väldigt proaktiv – kom med egna idéer och förbättringar</option>
              </select>
            </div>

            <div class="agent-option">
              <input type="checkbox" id="rule-mentor-mode" checked />
              <label for="rule-mentor-mode">
                Agera som <strong>mentor</strong>: rätta slarviga promptar och föreslå smartare lösningar.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="rule-dependency-warnings" checked />
              <label for="rule-dependency-warnings">
                Varna om en ändring kan påverka andra delar (beroenden, routes, databas m.m.).
              </label>
            </div>
          </div>

          <!-- Egna regler -->
          <div class="agent-section">
            <div class="agent-section-title">Egna regler (valfritt)</div>
            <textarea
              id="rule-custom"
              class="agent-textarea"
              placeholder="Skriv egna regler eller önskemål, t.ex. 'prioritera integrations-moduler', 'var extra försiktig med databasen' osv."
            ></textarea>
          </div>
        </section>

        <!-- BLOCK 2: Automatiseringar -->
        <section class="agent-panel" id="automation-card">
          <h2>Block 2 – Automatiseringar & scope</h2>
          <p class="agent-panel-desc">
            Här väljer du vad agenten ska göra automatiskt, och vad den ska låta bli att röra.
          </p>

          <!-- Trådar & kontext -->
          <div class="agent-section">
            <div class="agent-section-title">Trådar & kontext</div>

            <div class="agent-select-group">
              <span class="agent-select-label">När ska ny tråd föreslås?</span>
              <select id="thread-threshold-select" class="agent-select">
                <option value="manual">Endast när användaren ber om det</option>
                <option value="short">Vid kortare trådar (~30 meddelanden)</option>
                <option value="medium" selected>Vid medellånga trådar (~60 meddelanden)</option>
                <option value="long">Först vid väldigt långa trådar (~100+ meddelanden)</option>
              </select>
            </div>

            <div class="agent-option">
              <input type="checkbox" id="auto-thread-length" checked />
              <label for="auto-thread-length">
                Föreslå <strong>ny tråd</strong> + kort sammanfattning när en konversation blir lång/tung.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="auto-carry-summary" checked />
              <label for="auto-carry-summary">
                För alltid över <strong>nyckelinformation (manifest)</strong> till nästa tråd.
              </label>
            </div>
          </div>

          <!-- Kodstil & kvalitet -->
          <div class="agent-section">
            <div class="agent-section-title">Kodstil & kvalitet</div>

            <div class="agent-select-group">
              <span class="agent-select-label">Kodstil / ambitionsnivå</span>
              <select id="code-style-select" class="agent-select">
                <option value="simple" selected>Så enkelt som möjligt</option>
                <option value="balanced">Balans – rimligt strukturerat</option>
                <option value="advanced">Avancerat – gärna patterns och abstrahering</option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Testnivå</span>
              <select id="tests-select" class="agent-select">
                <option value="none">Inga tester om inte jag ber om det</option>
                <option value="basic" selected>Föreslå enkla tester vid större ändringar</option>
                <option value="plan">Försök alltid skissa en teststrategi</option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Logging / felsökning</span>
              <select id="logging-select" class="agent-select">
                <option value="minimal" selected>Minimal logging</option>
                <option value="diagnostic">Lägg gärna till extra logging för felsökning</option>
                <option value="avoid">Undvik logging om det inte behövs</option>
              </select>
            </div>

            <div class="agent-select-group">
              <span class="agent-select-label">Felhantering i kod</span>
              <select id="error-handling-select" class="agent-select">
                <option value="minimal">Minimal (happy path)</option>
                <option value="standard" selected>Standard (rimlig felhantering)</option>
                <option value="defensive">Defensiv (validera mycket, flera kontroller)</option>
              </select>
            </div>
          </div>

          <!-- Scope-begränsningar -->
          <div class="agent-section">
            <div class="agent-section-title">Scope – vad agenten INTE ska göra</div>
            <div class="agent-option">
              <input type="checkbox" id="scope-no-db-schema" />
              <label for="scope-no-db-schema">
                Ändra inte databas-schema (Prisma/Neon) om jag inte uttryckligen ber om det.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="scope-no-auth" />
              <label for="scope-no-auth">
                Rör inte autentisering/säkerhetslogik utan tydligt godkännande.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="scope-no-major-ui" />
              <label for="scope-no-major-ui">
                Gör inga stora UI-ombyggnader – håll dig till små förbättringar.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="scope-no-new-deps" />
              <label for="scope-no-new-deps">
                Lägg inte till nya externa beroenden (npm-paket) utan att först föreslå dem och vänta på OK.
              </label>
            </div>
          </div>

          <!-- Git & risk / sammanfattning -->
          <div class="agent-section">
            <div class="agent-section-title">Git & riskmedvetenhet</div>

            <div class="agent-select-group">
              <span class="agent-select-label">Git-kommandon i svar</span>
              <select id="git-mode-select" class="agent-select">
                <option value="always" selected>Alltid föreslå git-kommandon efter ändringar</option>
                <option value="big">Endast vid större kodändringar</option>
                <option value="never">Föreslå inte git-kommandon automatiskt</option>
              </select>
            </div>

            <div class="agent-option">
              <input type="checkbox" id="toggle-show-risks" />
              <label for="toggle-show-risks">
                Visa alltid en kort sektion om <strong>risker / saker att tänka på</strong> vid större förändringar.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="toggle-final-summary" />
              <label for="toggle-final-summary">
                Avsluta längre svar med en <strong>kort sammanfattning</strong>.
              </label>
            </div>
          </div>

          <!-- Presets (konceptuellt) -->
          <div class="agent-section">
            <div class="agent-section-title">Övergripande “personlighet”</div>
            <div class="agent-select-group">
              <span class="agent-select-label">Preset (beskrivning)</span>
              <select id="preset-select" class="agent-select">
                <option value="none" selected>Ingen särskild preset (använd inställningarna ovan)</option>
                <option value="safe-beginner">Trygg nybörjar-mode</option>
                <option value="build-fast">Bygg kod snabbt</option>
                <option value="code-review">Kod-review-läge (fokusera på granskning)</option>
              </select>
            </div>
          </div>

          <!-- Egna automationer -->
          <div class="agent-section">
            <div class="agent-section-title">Egna automatiseringsidéer</div>
            <textarea
              id="automation-custom"
              class="agent-textarea"
              placeholder="Skriv idéer för framtida automation, t.ex. 'kolla Render-loggar', 'förslag på refaktorering' osv."
            ></textarea>
          </div>
        </section>
      </main>

      <!-- Sammanfattning + genererad prompt -->
      <section class="agent-summary-card">
        <h3 class="agent-summary-title">Aktiv agentprofil (översikt)</h3>
        <div class="agent-summary-text" id="agent-summary-text">
          Välj regler och automatiseringar ovan så visas här en enkel sammanfattning.
        </div>
        <div class="agent-pill-row" id="agent-pill-row"></div>
      </section>

      <section class="agent-prompt-box">
        <div class="agent-prompt-header">
          <h3>Genererad agent-prompt</h3>
          <button type="button" class="agent-btn" id="copy-prompt-btn">
            Kopiera till urklipp
          </button>
        </div>
        <p class="agent-prompt-note">
          Texten nedan kan användas som <code>system-prompt</code> i en ChatGPT-tråd eller via API när du vill
          aktivera denna profil.
        </p>
        <textarea
          id="agent-prompt-output"
          class="agent-prompt-textarea"
          readonly
        ></textarea>
      </section>

<!-- =============================== -->
<!-- NYTT: Prata med agenten -->
<!-- =============================== -->
<section class="agent-prompt-box">
  <h3>Prata med PeerRate-agenten</h3>

  <p class="agent-prompt-note">
    Den genererade agent-prompten ovan används automatiskt som <code>systemPrompt</code>.
  </p>

  <textarea
    id="agent-user-input"
    class="agent-prompt-textarea"
    placeholder="Ställ en fråga, t.ex:
'Hjälp mig bygga nästa steg i PeerRate-backend'"
  ></textarea>

  <button
    type="button"
    class="agent-btn"
    id="agent-send-btn"
    style="margin-top:8px;"
  >
    Skicka till agenten
  </button>

  <pre
    id="agent-response"
    style="
      margin-top:12px;
      padding:10px;
      background:#fff;
      border-radius:12px;
      white-space:pre-wrap;
      font-size:12px;
      display:none;
    "
  ></pre>
</section>
<section style="margin-top:14px; background:#fff; border-radius:18px; border:1px solid rgba(0,0,0,.05); padding:14px;">
  <h3 style="margin:0 0 6px; font-size:14px;">Testa agenten</h3>
  <p style="margin:0 0 10px; font-size:12px; color:var(--brand-ink-d); line-height:1.4;">
    När du är klar med inställningarna kan du gå vidare till chatten och testa system-prompten direkt.
  </p>
  <a href="/agent-chat.html"
     style="display:inline-flex; align-items:center; justify-content:center; padding:12px 18px; border-radius:999px; border:0; background:var(--brand-purple); color:#fff; font-size:13px; font-weight:800; text-decoration:none;">
    Öppna Agent-chatten →
  </a>
</section>

      <div class="agent-footer">
        Denna sida är ett kontrollcenter för din framtida PeerRate-agent. Själva AI-kopplingen görs senare via
        OpenAI API, men här designar du reglerna och beteendet.
      </div>
    </div>
  </div>

  <script type="module" src="./modules/agent.js"></script>
</body>
</html>
