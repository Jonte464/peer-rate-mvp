<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>PeerRate Agent – Inställningar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="./style.css" />

  <style>
    :root {
      --brand-orange:#f6a94b;
      --brand-card:#fbf2e6;
      --brand-border:#eadfce;
      --brand-ink:#1e1830;
      --brand-ink-d:#4a425e;
      --brand-purple:#1b1533;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color: var(--brand-ink);
      background: var(--brand-orange);
    }

    .agent-page-wrap {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 16px;
    }

    .agent-card-shell {
      width: 100%;
      max-width: 960px;
      background: var(--brand-card);
      border-radius: 24px;
      border: 1px solid var(--brand-border);
      box-shadow: 0 18px 45px rgba(0,0,0,.12);
      padding: 20px 22px 24px;
    }

    .agent-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }

    .agent-title {
      font-size: 22px;
      font-weight: 800;
      margin: 0;
    }

    .agent-sub {
      font-size: 13px;
      color: var(--brand-ink-d);
      margin: 4px 0 0;
    }

    .agent-layout {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-top: 14px;
      margin-bottom: 16px;
    }

    .agent-panel {
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.05);
      padding: 14px 14px 16px;
    }

    .agent-panel h2 {
      margin: 0 0 6px;
      font-size: 16px;
    }

    .agent-panel-desc {
      font-size: 12px;
      color: var(--brand-ink-d);
      margin: 0 0 10px;
    }

    .agent-section {
      margin-bottom: 10px;
    }

    .agent-section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .06em;
      color: var(--brand-ink-d);
      margin-bottom: 4px;
    }

    .agent-option {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      font-size: 13px;
      color: var(--brand-ink);
    }

    .agent-option input[type="checkbox"] {
      width: 18px;
      height: 18px;
      transform: scale(1.15);
      margin: 0;
    }

    .agent-option label {
      cursor: pointer;
      line-height: 1.4;
    }

    .agent-textarea {
      width: 100%;
      min-height: 70px;
      border-radius: 12px;
      border: 1px solid #d9cbb7;
      background: #fff;
      color: var(--brand-ink);
      padding: 8px 10px;
      font-size: 12px;
      resize: vertical;
      font-family: inherit;
    }

    .agent-select-group {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
      color: var(--brand-ink);
    }

    .agent-select-label {
      font-weight: 600;
    }

    .agent-select {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #d9cbb7;
      background: #fff;
      color: var(--brand-ink);
      padding: 6px 10px;
      font-size: 12px;
      font-family: inherit;
    }

    .agent-summary-card {
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.05);
      padding: 12px 14px 16px;
      margin-top: 4px;
    }

    .agent-summary-title {
      font-size: 14px;
      font-weight: 700;
      margin: 0 0 4px;
    }

    .agent-summary-text {
      font-size: 12px;
      color: var(--brand-ink);
      line-height: 1.4;
    }

    .agent-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .agent-pill {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #d1c4b8;
      font-size: 11px;
      background: #fff7f0;
      color: var(--brand-ink-d);
    }

    .agent-prompt-box {
      margin-top: 14px;
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.05);
      padding: 12px 14px 16px;
    }

    .agent-prompt-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .agent-prompt-header h3 {
      margin: 0;
      font-size: 14px;
    }

    .agent-prompt-note {
      font-size: 11px;
      color: var(--brand-ink-d);
      margin: 0 0 6px;
    }

    .agent-prompt-textarea {
      width: 100%;
      min-height: 90px;
      border-radius: 12px;
      border: 1px solid #d9cbb7;
      background: #fffaf4;
      color: var(--brand-ink);
      padding: 8px 10px;
      font-size: 12px;
      resize: vertical;
      font-family: inherit;
    }

    .agent-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: 999px;
      border: 0;
      background: var(--brand-purple);
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
    }

    .agent-btn:hover {
      filter: brightness(1.05);
    }

    .agent-footer {
      margin-top: 8px;
      font-size: 11px;
      color: var(--brand-ink-d);
    }

    .agent-footer code {
      font-size: 11px;
      background: rgba(0,0,0,.03);
      padding: 1px 3px;
      border-radius: 4px;
    }

    @media (max-width: 900px) {
      .agent-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="agent-page-wrap">
    <div class="agent-card-shell">
      <header class="agent-header-bar">
        <div>
          <h1 class="agent-title">PeerRate Agent – inställningar</h1>
          <p class="agent-sub">
            Ställ in vilka regler och automatiska beteenden din utvecklar-/AI-agent ska följa.
          </p>
        </div>
      </header>

      <main class="agent-layout">
        <!-- BLOCK 1: Regler / Promptprofil -->
        <section class="agent-panel" id="rules-card">
          <h2>Block 1 – Regler & stil</h2>
          <p class="agent-panel-desc">
            Här väljer du hur agenten ska skriva, tänka och förhålla sig till kod.
          </p>

          <div class="agent-section">
            <div class="agent-section-title">Språk & pedagogik</div>

            <!-- Kunskapsnivå -->
            <div class="agent-select-group">
              <span class="agent-select-label">Kunskapsnivå</span>
              <select id="level-select" class="agent-select">
                <option value="beginner" selected>Nybörjare</option>
                <option value="intermediate">Medel</option>
                <option value="expert">Expert</option>
              </select>
            </div>

            <!-- Svarstyp / grounding -->
            <div class="agent-select-group">
              <span class="agent-select-label">Hur ska svaren vara grundade?</span>
              <select id="answer-style-select" class="agent-select">
                <option value="reflective" selected>
                  Reflekterande / hypotetiska (mycket resonemang)
                </option>
                <option value="strict">
                  Strikta, icke-hallucinerande (så korrekt som möjligt)
                </option>
              </select>
            </div>

            <!-- NY: Max antal steg per svar -->
            <div class="agent-select-group">
              <span class="agent-select-label">Max antal steg per svar</span>
              <select id="steps-select" class="agent-select">
                <option value="1">1 steg</option>
                <option value="2">2 steg</option>
                <option value="3" selected>3 steg</option>
                <option value="4">4 steg</option>
                <option value="5">5 steg</option>
                <option value="6">6 steg</option>
                <option value="7">7 steg</option>
                <option value="8">8 steg</option>
                <option value="9">9 steg</option>
                <option value="10">10 steg</option>
              </select>
            </div>
          </div>

          <div class="agent-section">
            <div class="agent-section-title">Kod & säkerhet</div>
            <div class="agent-option">
              <input type="checkbox" id="rule-no-hallucinations" checked />
              <label for="rule-no-hallucinations">
                Minimera <strong>hallucinationer</strong>: om information saknas, fråga istället för att hitta på.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="rule-full-blocks" checked />
              <label for="rule-full-blocks">
                Ge alltid <strong>hela kodblock eller hela filer</strong> som kan klistras in direkt i VS Code.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="rule-ask-for-current-code" checked />
              <label for="rule-ask-for-current-code">
                Be alltid först om <strong>nuvarande kod</strong> innan du föreslår ny kod.
              </label>
            </div>
          </div>

          <div class="agent-section">
            <div class="agent-section-title">Mentorskap</div>

            <!-- NY: Mentor-nivå -->
            <div class="agent-select-group">
              <span class="agent-select-label">Mentor-nivå</span>
              <select id="mentor-level-select" class="agent-select">
                <option value="soft" selected>Mjuk coach (stödjande, försiktig feedback)</option>
                <option value="balanced">Balans (ärlig men vänlig)</option>
                <option value="direct">Direkt (väldigt tydlig och rakt på sak)</option>
              </select>
            </div>

            <div class="agent-option">
              <input type="checkbox" id="rule-mentor-mode" checked />
              <label for="rule-mentor-mode">
                Agera som <strong>mentor</strong>: rätta slarviga promptar och föreslå smartare lösningar.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="rule-dependency-warnings" checked />
              <label for="rule-dependency-warnings">
                Varna om en ändring kan påverka andra delar (beroenden, routes, databas m.m.).
              </label>
            </div>
          </div>

          <div class="agent-section">
            <div class="agent-section-title">Egna regler (valfritt)</div>
            <textarea
              id="rule-custom"
              class="agent-textarea"
              placeholder="Skriv egna regler eller önskemål, t.ex. 'prioritera Tradera-modulen', 'var extra försiktig med databasen' osv."
            ></textarea>
          </div>
        </section>

        <!-- BLOCK 2: Automatiseringar -->
        <section class="agent-panel" id="automation-card">
          <h2>Block 2 – Automatiseringar</h2>
          <p class="agent-panel-desc">
            Här väljer du vad agenten ska göra automatiskt, t.ex. trådhantering och git-hjälp.
          </p>

          <div class="agent-section">
            <div class="agent-section-title">Trådar & kontext</div>

            <!-- NY: När föreslå ny tråd -->
            <div class="agent-select-group">
              <span class="agent-select-label">När ska ny tråd föreslås?</span>
              <select id="thread-threshold-select" class="agent-select">
                <option value="manual">Endast när användaren ber om det</option>
                <option value="short">När tråden blivit ganska lång (~30 meddelanden)</option>
                <option value="medium" selected>Vid längre trådar (~60 meddelanden)</option>
                <option value="long">Först vid väldigt långa trådar (~100+ meddelanden)</option>
              </select>
            </div>

            <div class="agent-option">
              <input type="checkbox" id="auto-thread-length" checked />
              <label for="auto-thread-length">
                Föreslå <strong>ny tråd</strong> + kort sammanfattning när en konversation blir lång/tung.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="auto-carry-summary" checked />
              <label for="auto-carry-summary">
                För alltid över <strong>nyckelinformation (manifest)</strong> till nästa tråd.
              </label>
            </div>
          </div>

          <div class="agent-section">
            <div class="agent-section-title">Kod & utveckling</div>

            <!-- NY: Hur ofta ge git-kommandon -->
            <div class="agent-select-group">
              <span class="agent-select-label">Git-kommandon i svar</span>
              <select id="git-mode-select" class="agent-select">
                <option value="always" selected>Alltid föreslå git-kommandon efter ändringar</option>
                <option value="big">Endast vid större kodändringar</option>
                <option value="never">Föreslå inte git-kommandon automatiskt</option>
              </select>
            </div>

            <div class="agent-option">
              <input type="checkbox" id="auto-git-commands" checked />
              <label for="auto-git-commands">
                Avsluta större ändringar med <strong>färdiga Git-kommandon</strong> (PowerShell) för deploy.
              </label>
            </div>
            <div class="agent-option">
              <input type="checkbox" id="auto-vscode-friendly" checked />
              <label for="auto-vscode-friendly">
                Anpassa alltid instruktioner till <strong>VS Code + GitHub + Render prod</strong>.
              </label>
            </div>
          </div>

          <div class="agent-section">
            <div class="agent-section-title">Framtida automatiseringar</div>
            <textarea
              id="automation-custom"
              class="agent-textarea"
              placeholder="Skriv idéer för framtida automation, t.ex. 'kolla Render-loggar', 'förslag på refaktorering' osv."
            ></textarea>
          </div>
        </section>
      </main>

      <!-- Sammanfattning + genererad prompt -->
      <section class="agent-summary-card">
        <h3 class="agent-summary-title">Aktiv agentprofil (översikt)</h3>
        <div class="agent-summary-text" id="agent-summary-text">
          Välj regler och automatiseringar ovan så visas här en enkel sammanfattning.
        </div>
        <div class="agent-pill-row" id="agent-pill-row"></div>
      </section>

      <section class="agent-prompt-box">
        <div class="agent-prompt-header">
          <h3>Genererad agent-prompt</h3>
          <button type="button" class="agent-btn" id="copy-prompt-btn">
            Kopiera till urklipp
          </button>
        </div>
        <p class="agent-prompt-note">
          Texten nedan kan användas som <code>system-prompt</code> i en ChatGPT-tråd eller via API när du vill
          aktivera denna profil.
        </p>
        <textarea
          id="agent-prompt-output"
          class="agent-prompt-textarea"
          readonly
        ></textarea>
      </section>

      <div class="agent-footer">
        Denna sida är ett kontrollcenter för din framtida PeerRate-agent. Själva AI-kopplingen görs senare via
        OpenAI API, men här designar du reglerna och beteendet.
      </div>
    </div>
  </div>

  <script type="module" src="./modules/agent.js"></script>
</body>
</html>
