<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lämna betyg – PeerRate</title>

  <link rel="stylesheet" href="/css/pr-theme.css" />
  <link rel="stylesheet" href="/css/index.css" />
</head>

<body>
  <!-- ✅ Global TOP ROW injectas via pageBootstrap.js -->
  <div id="slot-top-row"></div>

  <main>
    <section id="rate" class="section white-block anchor">
      <div class="shell">
        <div class="pr-form-wrap" style="max-width: 980px; margin:0 auto;">

          <!-- ✅ HUB INTRO -->
          <section class="pr-card" style="margin-bottom:16px;">
            <h1 style="margin:0 0 6px;" data-i18n="rate_hub_h1">Lämna betyg – via verifierad affär</h1>
            <p style="margin:0;color:var(--pr-muted);font-size:14px;line-height:1.55;" data-i18n="rate_hub_lead">
              För att undvika spam och manipulation kan du bara lämna betyg när vi kan koppla det till en avslutad affär.
              Välj hur du vill verifiera.
            </p>
          </section>

          <!-- ✅ Steg 1: Verifieringsmetod -->
          <section class="pr-card" style="margin-bottom:16px;">
            <h2 style="margin:0 0 10px;" data-i18n="rate_method_title">Steg 1: Välj verifieringsmetod</h2>

            <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
              <!-- Plattform -->
              <div style="border:1px solid rgba(0,0,0,.08);background:#fff;border-radius:14px;padding:14px;">
                <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                  <div>
                    <div style="font-weight:900;color:var(--pr-purple);" data-i18n="rate_method_platform_title">
                      Plattform (snabbast)
                    </div>
                    <div style="color:var(--pr-muted);font-size:12px;line-height:1.45;" data-i18n="rate_method_platform_lead">
                      Öppna plattformen → hitta avslutad affär → klicka på extensionen → kom tillbaka hit.
                    </div>
                  </div>
                  <button class="pr-btn pr-btn-primary" type="button" id="choosePlatformBtn">
                    <span data-i18n="rate_method_choose_platform">Välj</span> →
                  </button>
                </div>
              </div>

              <!-- E-post -->
              <div style="border:1px solid rgba(0,0,0,.08);background:#fff;border-radius:14px;padding:14px;">
                <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                  <div>
                    <div style="font-weight:900;color:var(--pr-purple);" data-i18n="rate_method_email_title">
                      E-post/kvitton (automatiskt framöver)
                    </div>
                    <div style="color:var(--pr-muted);font-size:12px;line-height:1.45;" data-i18n="rate_method_email_lead">
                      Koppla din inkorg så kan vi hitta avslutade affärer och ge dig färdiga betygsförslag.
                    </div>
                  </div>
                  <button class="pr-btn pr-btn-ghost" type="button" id="chooseEmailBtn">
                    <span data-i18n="rate_method_choose_email">Visa</span> →
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- ✅ Plattform-flöde (visas när man valt Plattform) -->
          <section class="pr-card" id="platform-card" style="margin-bottom:16px; display:none;">
            <h2 style="margin:0 0 8px;" data-i18n="rate_platform_title">Steg 2: Starta från en plattform</h2>

            <p style="margin:0 0 12px;color:var(--pr-muted);font-size:13px;line-height:1.45;"
               data-i18n="rate_platform_lead">
              Välj plattform och typ av affär. Vi öppnar plattformen – du letar upp den avslutade affären och klickar på extensionen.
            </p>

            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end;">
              <div class="pr-field" style="flex:1;min-width:240px;margin:0;">
                <label class="pr-label" for="platformSelect" data-i18n="rate_platform_label">Plattform</label>
                <select class="pr-select" id="platformSelect">
                  <option value="" selected data-i18n="rate_platform_pick">Välj plattform…</option>
                  <option value="tradera">Tradera</option>
                  <option value="blocket">Blocket</option>
                  <option value="airbnb">Airbnb</option>
                  <option value="ebay">eBay</option>
                  <option value="tiptap">Tiptap</option>
                  <option value="hygglo">Hygglo</option>
                  <option value="husknuten">Husknuten</option>
                  <option value="facebook">Facebook Marketplace</option>
                </select>
              </div>

              <div class="pr-field" style="flex:1;min-width:240px;margin:0;">
                <label class="pr-label" for="platformFlow" data-i18n="rate_platform_flow_label">Typ av affär</label>
                <select class="pr-select" id="platformFlow">
                  <option value="" selected data-i18n="rate_platform_flow_pick">Välj…</option>
                  <option value="buy" data-i18n="rate_platform_flow_buy">Köp</option>
                  <option value="sell" data-i18n="rate_platform_flow_sell">Sälj</option>
                  <option value="booking" data-i18n="rate_platform_flow_booking">Bokning/hyra</option>
                  <option value="other" data-i18n="rate_platform_flow_other">Annat</option>
                </select>
              </div>

              <button class="pr-btn pr-btn-primary" type="button" id="platformGoBtn" disabled style="min-width:200px;">
                <span data-i18n="rate_platform_go">Öppna plattform</span> →
              </button>
            </div>

            <div id="platformNote" style="margin-top:10px;color:var(--pr-muted);font-size:12px;line-height:1.55;">
              <div id="platformSteps">
                <b>Så gör du:</b>
                <ol style="margin:6px 0 0 18px;padding:0;">
                  <li>Öppna plattformen.</li>
                  <li>Hitta den avslutade affären (gärna “order/receipt/kvitto” eller “completed”).</li>
                  <li>Klicka på PeerRate-extensionen för att skicka verifierad info.</li>
                </ol>
              </div>
              <div style="margin-top:8px;">
                <span data-i18n="rate_platform_note">
                  Tips: När du skickat från extensionen kommer du tillbaka hit med “Verifierad källa” ifyllt.
                </span>
              </div>
            </div>
          </section>

          <!-- ✅ E-post-flöde (visas när man valt E-post) -->
          <section class="pr-card" id="email-card" style="margin-bottom:16px; display:none;">
            <h2 style="margin:0 0 8px;" data-i18n="rate_email_title">Steg 2: Verifiera via e-post/kvitton</h2>

            <p style="margin:0 0 12px;color:var(--pr-muted);font-size:13px;line-height:1.55;" data-i18n="rate_email_lead">
              Kommer snart: Koppla Gmail/Outlook så kan vi automatiskt identifiera avslutade affärer och skapa betygsförslag.
            </p>

            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
              <button class="pr-btn pr-btn-primary" type="button" disabled style="opacity:.6;cursor:not-allowed;">
                <span data-i18n="rate_email_connect">Koppla inkorg</span> (Coming soon)
              </button>
              <span style="color:var(--pr-muted);font-size:12px;" data-i18n="rate_email_note">
                Under tiden: använd plattformsflödet (snabbast).
              </span>
            </div>
          </section>

          <!-- ✅ Verifierade affärer (tomt tills e-post / backend finns) -->
          <section class="pr-card" id="verified-deals-card" style="margin-bottom:16px;">
            <h2 style="margin:0 0 8px;" data-i18n="rate_verified_title">Verifierade affärer</h2>
            <p style="margin:0 0 10px;color:var(--pr-muted);font-size:13px;line-height:1.55;" data-i18n="rate_verified_lead">
              Här kommer dina identifierade avslutade affärer att synas. Därifrån kan du lämna betyg.
            </p>

            <div id="verified-empty" style="border:1px dashed rgba(0,0,0,.18);background:#fff;border-radius:14px;padding:12px;color:var(--pr-muted);font-size:13px;">
              Inga verifierade affärer än.
            </div>

            <div id="verified-list" style="display:none;"></div>
          </section>

          <!-- ✅ KÄLLA (auto från extension: ?source=...&pageUrl=...) -->
          <section class="pr-card" id="rate-context-card" style="display:none;margin-bottom:16px;">
            <div style="display:flex;align-items:flex-start;gap:12px;flex-wrap:wrap;">
              <div style="flex:1;min-width:240px;">
                <div style="font-weight:900;color:var(--pr-purple);margin-bottom:4px;">
                  Verifierad källa
                </div>
                <div style="color:var(--pr-muted);font-size:13px;line-height:1.45;">
                  Källa: <span id="rate-context-source" style="font-weight:800;color:var(--pr-ink);">–</span><br/>
                  <a id="rate-context-link" href="#" target="_blank" rel="noopener noreferrer"
                     style="display:inline-block;margin-top:6px;font-weight:800;">
                    Visa sidan som triggar betyget →
                  </a>
                </div>
              </div>

              <div style="min-width:240px;border:1px solid rgba(0,0,0,.08);background:#fff;border-radius:12px;padding:12px;">
                <div style="font-weight:900;color:var(--pr-purple);margin-bottom:4px;">Tips</div>
                <div style="color:var(--pr-muted);font-size:13px;line-height:1.45;">
                  Nästa steg: När vi har hårda data (motpart, belopp, datum) visar vi ett låst betygsformulär.
                </div>
              </div>
            </div>
          </section>

          <!-- ✅ LOGIN (kan behövas senare när man faktiskt betygsätter) -->
          <section class="pr-card" id="login-card">
            <h2 data-i18n="rate_login_title">Logga in</h2>
            <p style="margin:0 0 10px;color:var(--pr-muted);font-size:13px;" data-i18n="rate_login_lead">
              Logga in med den e-post och det lösenord du registrerade dig med.
            </p>

            <form id="rating-login-form" autocomplete="off">
              <div class="pr-field">
                <label class="pr-label" for="login-email" data-i18n="rate_login_email_label">E-post</label>
                <input class="pr-input" id="login-email" name="email" type="email" placeholder="erik@example.com" />
              </div>

              <div class="pr-field">
                <label class="pr-label" for="login-password" data-i18n="rate_login_password_label">Lösenord</label>
                <input class="pr-input" id="login-password" name="password" type="password"
                       data-i18n-placeholder="rate_login_password_ph" placeholder="Ditt lösenord" />
                <a href="/reset-password.html" style="display:inline-block;margin-top:6px;font-size:12px;color:#1d4ed8;text-decoration:none;font-weight:600;">
                  Forgot your password?
                </a>
              </div>

              <div class="pr-actions">
                <button class="pr-btn pr-btn-primary" type="submit" id="login-btn" data-i18n="rate_login_btn">Logga in</button>
                <a class="pr-btn pr-btn-ghost" href="/customer.html" data-i18n="rate_signup">Registrera dig</a>
              </div>

              <p id="login-status" style="margin-top:10px;color:var(--pr-muted);font-size:12px;"></p>
            </form>
          </section>

          <!-- ❌ OBS: Inget öppet betygsformulär på denna sida längre. -->
        </div>
      </div>
    </section>
  </main>

  <!-- ✅ Single entrypoint: inject header → init language → load main.js -->
  <script type="module" src="/modules/pageBootstrap.js?v=2"></script>
</body>
</html>
